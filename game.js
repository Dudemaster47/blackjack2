const readline = require('readline');

const {Actor} = require("./class/actor.js");
const {Player} = require("./class/player.js");
const {Dealer} = require("./class/dealer.js");
const {Roster} = require("./class/roster.js");
const {Deck} = require("./class/deck.js");
const {Card} = require("./class/card.js");
const {Loader} = require("./class/loader.js");

const cardData = require("./data/card-data.js");

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
  });

function printHelp(){
  console.log("Commands:");
  console.log("Type h at any time to review the list of commands.");
  console.log("Type 'hit' to draw another card");
  console.log("Type 'stand' to end your turn");
  console.log("Type 'hand' to list the contents of your hand.");
  console.log("Type 'table' to see everyone else's hands!");
  console.log("Split and double down functionality coming eventually.")
}

function startGame(){
  console.clear();
  rl.question(`  (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(#@*&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.&@@@@@@@#*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,%@@@@@@@@@@@(*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.@@@@@@@@@@@@@@@@#,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&.@@@@@@@@@@@@@@@@@@@@@.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.%@@@@@@@@@@@@@@@@@@@@@@@@@#*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@& @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@% @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@**@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&(*/#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@%              %(      @@@@@@@@@@@@          ,@@@@@@(          (.     *@@@      *@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@%      @@%     ,#      @@@@@@@@@@@,           (@@@*            (.     *@@      (@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@%      @@@*    ,#      @@@@@@@@@@(     ,       @@.            .@.     *@      %@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@%      ,.      *#      @@@@@@@@@@     ,@@       %        %@@@@@@.            &@@ @@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@%             .@(      @@@@@@@@@.     @@@(     .(       *@@@@@@@.           (@@@@@ @@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@.@%      @@@/    ,#      @@@@@@@@/     ,%%%%.     &             /@.     ,/     .@@@@@#/@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@.@@%      @@@*    ,#      @@@@@@@&                 ,(             %.     *@#      @@@@@@ @@@@@@@@@@@@@  
    (@@@@@@@@@@@@.@@@%              ,#            @      %@@@@@@/      @.           (.     *@@#      #@@@@@.@@@@@@@@@@@@  
    (@@@@@@@@@@@,&@@@%             ,@@&&&&&&&&   %&&&&&&&@@@@@@@@.   (&%((#&%*&&&&&&@%  .&&&@@@@&     ,@@@@%(@@@@@@@@@@@  
    (@@@@@@@@@@@.@@@@@@@@@@@@@@@@@@@@%       %@@@,          @@@@@@@,         .#      @@@/      @@@@@@@@@@@@@.@@@@@@@@@@@  
    (@@@@@@@@@@##@@@@@@@@@@@@@@@@@@@@%       %@@#           ,@@@@            .#      @@*     .@@@@@@@@@@@@@@*@@@@@@@@@@@  
    (@@@@@@@@@@(%@@@@@@@@@@@@@@@@@@@@%       %@@             #@%             ##      @.     .@@@@@@@@@@@@@@@*@@@@@@@@@@@  
    (@@@@@@@@@@&,@@@@@@@@@@@@@@@@@@@@%       %@      @@       @.       .&@@%#@#            /@@@@@@@@@@@@@@@@.@@@@@@@@@@@  
    (@@@@@@@@@@@ &@@@@@@@@@@@%, .@@@@%       %/     (@@&      &        @@@@@@@#           ,@@@@@@@@@@@@@@@@#*@@@@@@@@@@@  
    (@@@@@@@@@@@@ @@@@@@@@@@*    @@@@*       &      @@@@/     (,             @#      #      @@@@@@@@@@@@@@@ @@@@@@@@@@@@  
    (@@@@@@@@@@@@@ @@@@@@@@@(               @                  &             .#      @&      %@@@@@@@@@@@% @@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@*/@@@@@@@@/             (,     .&&&&&&%      ((           .#      @@@      *@@@@@@@@@,#@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@//@@@@@@@@#          *#      @@@.@@@@/      *@@,        .#      @@@@       @@@@@@.#@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@,/@@@@@@@@@@@@@@@@@@@@@@@@@,#@@@@@@@/@@&%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,*@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@%./@@@@@@@@@@@@@@@@@@%.&@@@@@@@@@.@@&,@@@@@@@@@%.&@@@@@@@@@@@@@@@@@&*.&@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@(, .,/((/*,./@@@@@@@@@@@@@%*@@@ @@@@@@@@@@@@@&*.,//((/,..,#@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.@@@@&,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,#@@@@@//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.#@@@@@@@*/@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@%.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*(@@@@@@@@@@@@@*#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*%@@@@@@@@@@@@@@@@@//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  
    (&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& `, () => {
      console.clear();
      console.log(`Node Blackjack ver. 0.2
      Developed by Alex Hiller, Megha Sahgal, and Brody Owen`);

      Loader.loadCards(cardData);
      

      printHelp();

      rl.question("Press the 'Any' key to begin your Blackjack adventure!", () => {
      
      console.clear();
      numberOfPlayers();
      });
    });
}

const numberOfPlayers = () => {
  rl.question(`First of all, how many players are there? `, firstQuestion)
}

const firstQuestion = (answer) => {
  if (!(isNaN(answer)) && Number(answer) <= 7){
      console.clear();
      console.log(`You responded ${answer} players. Is that correct?`);
      rl.question(`Y/N `, response =>{
              secondQuestion(response, answer)
      })

  }else if (Number(answer) > 7){
          console.clear();
          console.log(`The table limit is 7 players, bud.`)
          numberOfPlayers();

  }
  else {
      console.clear();
      console.log(`${answer} isn't a number. Try harder next time.`);
      numberOfPlayers();
  }

}

const secondQuestion = (conf, answer) =>{
  if (conf.toLowerCase() === 'y' || conf.toLowerCase() === 'yes'){
      console.clear();
      console.log(`Understood `);
      let playerCount = answer;
      playerRoster(playerCount);
  }
  else if (conf.toLowerCase() === 'n' ||  conf.toLowerCase() === 'no'){
      console.clear();
      console.log(`Understood.`);
      numberOfPlayers();
  }
  else {
      console.clear();
      console.log(`I'll take that as a 'no'.`);
      numberOfPlayers();
  }
}

let playerRoster = (playerCount) => {
  let roster = new Roster(1, [], playerCount);
  let deck = Loader.deckMerge(roster);
  recursiveQuestion(playerCount, roster, deck);
}

let n = 1
let recursiveQuestion = (playerCount, roster, deck) => {
    if(playerCount === 0){
        let dealer = new Dealer("Dealer", 0);
        roster.dealerTurnSet(dealer);
        roster.addToRoster(dealer);
        console.clear();
        console.log(`Let's begin.`)
        firstDeal(roster, deck);
    }
    else{
    console.clear();
    rl.question(`Player ${n}, please enter your name. `, name => {
        console.log(roster.playerCount);
        let player = new Player(name, n, true);
        roster.addToRoster(player);
        n++
        recursiveQuestion((playerCount - 1), roster, deck);
    }); 
    }
}